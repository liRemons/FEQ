<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Electron</title>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="electron" class="md-header-anchor"></a><span>Electron</span></h1><h4><a name="主进程和渲染进程" class="md-header-anchor"></a><span>主进程和渲染进程</span></h4><p><span>在桌面端应用中，进程分为主进程和渲染进程。</span></p><p><span>以 electron + vue 为例：</span></p><ul><li><span>采用发布订阅模式，主进程通过 </span><code>ipcMain.on</code><span> 接收渲染进程发送的事件, 通过 </span><code>mainWindow.webContents.send</code><span> 发送事件</span></li><li><span>vue入口文件中通过 </span><code>ipcRenderer.send</code><span>发送该事件 ，</span><code>ipcRenderer.on</code><span>接收事件</span></li></ul><h4><a name="localstoragesessionstroge--存储如何实现" class="md-header-anchor"></a><code>localStorage,sessionStroge</code><span> 存储如何实现？</span></h4><p><span>目前还没找到好的解决办法，下面几种解决方式</span></p><ul><li><span>采用状态管理系统，类似于 vuex</span></li><li><span>第三方库 </span><code>electron-localStorage</code></li><li><span>重写方法，以读写文件的形式存储信息，主进程和渲染进程交互，将存储信息以 </span><code>json</code><span>文件形式保存本地，曲线救国的方式（推荐）</span></li></ul><h4><a name="首次安装或打包失败" class="md-header-anchor"></a><span>首次安装或打包失败？</span></h4><p><span>说实话electron这个问题困扰了很久（主要是懒）</span>
<span>在公司里也有项目，也已经配好了运行及打包环境，</span>
<span>但是在自己的电脑上因为网络的原因，没能够运行起来。</span>
<span>下面记录一下我踩过的坑</span></p><ol start='' ><li><span>关于electron首次运行及打包时需下载文件，但由于没法科学上网的原因，导致经常下载失败，还好有万能的淘宝</span></li><li><span>下面隆重介绍</span></li></ol><p><span>项目根目录下新建</span><code>.npmrc</code><span>文件 分别配置运行时下载的electron包和打包时所需的包，使用淘宝源下载（亲测有效）</span>
<code>ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/</code></p><p><code>ELECTRON_BUILDER_BINARIES_MIRROR=http://npm.taobao.org/mirrors/electron-builder-binaries/</code></p><p><span>如果您想自定义electron 的安装位置</span>
<span>项目根目录新建</span><code>install.nsh</code><span>文件：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="nsis"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="nsis"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 20px;"></div><div class="CodeMirror-gutters" style="display: none; height: 20px;"></div></div></div></pre><p><code>!macro preInit SetRegView 64 WriteRegExpandStr HKLM &quot;${INSTALL_REGISTRY_KEY}&quot; InstallLocation &quot;C:\Users\Administrator\AppData\szlims_winapp&quot; WriteRegExpandStr HKCU &quot;${INSTALL_REGISTRY_KEY}&quot; InstallLocation &quot;C:\Users\Administrator\AppData\szlims_winapp&quot; SetRegView 32 WriteRegExpandStr HKLM &quot;${INSTALL_REGISTRY_KEY}&quot; InstallLocation &quot;C:\Users\Administrator\AppData\szlims_winapp&quot; WriteRegExpandStr HKCU &quot;${INSTALL_REGISTRY_KEY}&quot; InstallLocation &quot;C:\Users\Administrator\AppData\szlims_winapp&quot; !macroend</code></p><p><span>package.json 增加 </span><code>nsis:{&quot;include&quot;: &quot;./install.nsh&quot;}</code></p><p><span>如果项目里引入了dll文件</span>
<span>package.json </span><code>build:{ &quot;extraResources&quot;: { &quot;from&quot;: &quot;要打包的路径&quot;, &quot;to&quot;: &quot;打包到哪里&quot; },}</code></p><h4><a name="如何设置开发者调试工具" class="md-header-anchor"></a><span>如何设置开发者调试工具？</span></h4><p><code>mainWindow.webContents.openDevTools();</code></p><h4><a name="如何监听文件下载进度" class="md-header-anchor"></a><span>如何监听文件下载进度？</span></h4><p><span>也是采用发布订阅模式</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mainWindow</span>.<span class="cm-property">webContents</span>.<span class="cm-property">session</span>.<span class="cm-property">on</span>(</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"will-download"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-def">event</span>, <span class="cm-def">item</span>, <span class="cm-def">webContents</span>) <span class="cm-operator">=&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 去除这里可以自定义保存位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">// const filePath = path.join(app.getPath("downloads"), item.getFilename());</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">// item.setSavePath(filePath);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">item</span>.<span class="cm-property">on</span>(<span class="cm-string">"updated"</span>, (<span class="cm-def">event</span>, <span class="cm-def">state</span>) <span class="cm-operator">=&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 计算当前下载的进度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num</span> <span class="cm-operator">=</span> ((<span class="cm-variable-2">item</span>.<span class="cm-property">getReceivedBytes</span>() <span class="cm-operator">/</span> <span class="cm-variable-2">item</span>.<span class="cm-property">getTotalBytes</span>()) <span class="cm-operator">*</span> <span class="cm-number">100</span>).<span class="cm-property">toFixed</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable-2">state</span> <span class="cm-operator">===</span> <span class="cm-string">"progressing"</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mainWindow</span>.<span class="cm-property">webContents</span>.<span class="cm-property">send</span>(<span class="cm-string">"getScheduleEvent"</span>, [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">item</span>.<span class="cm-property">getSavePath</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  ]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable-2">item</span>.<span class="cm-property">isPaused</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">state</span> <span class="cm-operator">===</span> <span class="cm-string">"interrupted"</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">"终止下载"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">item</span>.<span class="cm-property">on</span>(<span class="cm-string">"done"</span>, (<span class="cm-def">event</span>, <span class="cm-def">state</span>) <span class="cm-operator">=&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable-2">state</span> <span class="cm-operator">===</span> <span class="cm-string">"completed"</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mainWindow</span>.<span class="cm-property">webContents</span>.<span class="cm-property">send</span>(<span class="cm-string">"getScheduleEvent"</span>, [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"下载成功"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 发送当前保存的位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">item</span>.<span class="cm-property">getSavePath</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  ]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">state</span> <span class="cm-operator">===</span> <span class="cm-string">"cancelled"</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mainWindow</span>.<span class="cm-property">webContents</span>.<span class="cm-property">send</span>(<span class="cm-string">"getScheduleEvent"</span>, [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"取消下载"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">item</span>.<span class="cm-property">getSavePath</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  ]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  );</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 860px;"></div><div class="CodeMirror-gutters" style="display: none; height: 860px;"></div></div></div></pre><h4><a name="结语" class="md-header-anchor"></a><span>结语：</span></h4><p><span>目前还是刚入门electron的小白，在这里推荐几个地址：</span></p><p><a href='https://newsn.net/'><span>苏南大叔博客</span></a></p><p><a href='http://www.electronjs.org/'><span>Electron官方文档</span></a></p><p>&nbsp;</p></div>
</body>
</html>